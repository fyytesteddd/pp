-- https://pastebin.com/raw/UJyP9iW0
local PlayerModule = {}

function PlayerModule.Load(PlayerTab, Fluent)
    local LocalPlayer = game:GetService("Players").LocalPlayer
    local PlayerSection = PlayerTab:AddSection("Player Feature")
    
    -- WalkSpeed
    local walkSpeedValue = 16
    local walkSpeedToggle = PlayerSection:AddToggle("WalkSpeedToggle", {Title = "WalkSpeed", Default = false})
    local walkSpeedInput = PlayerSection:AddInput("WalkSpeedInput", {Title = "Set WalkSpeed", Default = "16", Placeholder = "Enter number (e.g. 50)", Numeric = true, Finished = false, Callback = function(v)
        walkSpeedValue = tonumber(v) or 16
        if walkSpeedToggle.Value then
            local char = LocalPlayer.Character
            if char and char:FindFirstChild("Humanoid") then
                char.Humanoid.WalkSpeed = walkSpeedValue
            end
        end
    end})
    
    walkSpeedToggle:OnChanged(function(e)
        local char = LocalPlayer.Character
        if char and char:FindFirstChild("Humanoid") then
            char.Humanoid.WalkSpeed = e and walkSpeedValue or 16
        end
    end)
    
    -- Infinite Jump
    local IJC
    local infJumpToggle = PlayerSection:AddToggle("InfiniteJump", {Title = "Infinite Jump", Default = false})
    infJumpToggle:OnChanged(function(e)
        local UIS = game:GetService("UserInputService")
        if e then
            IJC = UIS.JumpRequest:Connect(function()
                local char = LocalPlayer.Character
                if char and char:FindFirstChild("Humanoid") then
                    char.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                end
            end)
        elseif IJC then 
            IJC:Disconnect()
            IJC = nil 
        end
    end)
    
    -- NoClip
    local NCC
    local noClipToggle = PlayerSection:AddToggle("NoClip", {Title = "NoClip", Default = false})
    noClipToggle:OnChanged(function(e)
        if e then
            NCC = game:GetService("RunService").Stepped:Connect(function()
                local char = LocalPlayer.Character
                if char then
                    for _, p in ipairs(char:GetChildren()) do
                        if p:IsA("BasePart") then 
                            p.CanCollide = false 
                        end
                    end
                end
            end)
        elseif NCC then
            NCC:Disconnect()
            NCC = nil
            local char = LocalPlayer.Character
            if char then
                for _, p in ipairs(char:GetChildren()) do
                    if p:IsA("BasePart") then 
                        p.CanCollide = true 
                    end
                end
            end
        end
    end)
    
    -- Walk On Water
    local wow = false
    local wp
    local wallWalkToggle = PlayerSection:AddToggle("WalkOnWater", {Title = "Walk On Water", Default = false})
    wallWalkToggle:OnChanged(function(e)
        wow = e
        local char = LocalPlayer.Character
        if e and char then
            local hrp = char:FindFirstChild("HumanoidRootPart")
            if hrp then
                if wp then wp:Destroy() end
                wp = Instance.new("Part")
                wp.Anchored = true
                wp.CanCollide = true
                wp.Size = Vector3.new(20, 1, 20)
                wp.Transparency = 1
                wp.Position = Vector3.new(hrp.Position.X, 0, hrp.Position.Z)
                wp.Parent = workspace
            end
        elseif wp then 
            wp:Destroy()
            wp = nil 
        end
    end)
    
    game:GetService("RunService").Heartbeat:Connect(function()
        if wow and wp then
            local char = LocalPlayer.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                local p = char.HumanoidRootPart.Position
                wp.Position = Vector3.new(p.X, 0, p.Z)
            end
        end
    end)
    
    -- Oxygen Tank
    local RS = game:GetService("ReplicatedStorage")
    local net = RS.Packages._Index["sleitnick_net@0.2.0"].net
    local RF_E = net["RF/EquipOxygenTank"]
    local RF_U = net["RF/UnequipOxygenTank"]
    local ox = false
    local infOxygenToggle = PlayerSection:AddToggle("EquipOxygenTank", {Title = "Equip Oxygen Tank", Default = false})
    infOxygenToggle:OnChanged(function(e)
        ox = e
        if ox then 
            RF_E:InvokeServer(105)
        else 
            RF_U:InvokeServer() 
        end
    end)
    
    -- Fishing Radar
    local RF_R = net["RF/UpdateFishingRadar"]
    local espRadarToggle = PlayerSection:AddToggle("BypassFishingRadar", {Title = "Bypass Fishing Radar", Default = false})
    espRadarToggle:OnChanged(function(e)
        RF_R:InvokeServer(e and true or false)
    end)
    
    -- Respawn Position
    local saveCF = nil
    LocalPlayer.CharacterAdded:Connect(function(char)
        if not saveCF then return end
        local hrp = char:WaitForChild("HumanoidRootPart", 5)
        if hrp then 
            task.wait(.3)
            hrp.CFrame = saveCF 
        end
    end)
    
    PlayerSection:AddButton({Title = "Respawn at Current Position", Description = "Respawn at your current location", Callback = function()
        local char = LocalPlayer.Character
        if not char then return end
        local hrp = char:FindFirstChild("HumanoidRootPart")
        local hum = char:FindFirstChild("Humanoid")
        if hrp and hum then 
            saveCF = hrp.CFrame 
            hum.Health = 0 
        end
    end})
    
    -- GUI External
    local GuiSection = PlayerTab:AddSection("Gui External")
    GuiSection:AddButton({Title = "Fly GUI", Description = "Load Fly GUI", Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/XNEOFF/FlyGuiV3/main/FlyGuiV3.txt"))()
        Fluent:Notify({Title = "Fly", Content = "Fly GUI berhasil dijalankan âœ…", Duration = 3})
    end})
    
    -- Stats Overlay
    local SG, SL = nil, nil
    local statsOverlayToggle = GuiSection:AddToggle("StatsOverlay", {Title = "Show Stats Overlay", Description = "Menampilkan FPS, CPU(ms), Ping, RAM.", Default = false})
    statsOverlayToggle:OnChanged(function(e)
        if e then
            if SG then SG:Destroy() end
            local g = Instance.new("ScreenGui", game.CoreGui)
            g.Name = "RockHub_Stats"
            g.IgnoreGuiInset = true
            local f = Instance.new("Frame", g)
            f.Size = UDim2.fromOffset(360, 40)
            f.AnchorPoint = Vector2.new(.5, 0)
            f.Position = UDim2.new(.5, 0, .06, 0)
            f.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
            f.BackgroundTransparency = .2
            f.BorderSizePixel = 0
            Instance.new("UICorner", f).CornerRadius = UDim.new(1, 0)
            local s = Instance.new("UIStroke", f)
            s.Color = Color3.fromHex("8B5CF6")
            s.Thickness = 2
            s.Transparency = .1
            s.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
            local l = Instance.new("UIListLayout", f)
            l.FillDirection = Enum.FillDirection.Horizontal
            l.Padding = UDim.new(0, 12)
            l.HorizontalAlignment = Enum.HorizontalAlignment.Center
            l.VerticalAlignment = Enum.VerticalAlignment.Center
            
            local function L()
                local t = Instance.new("TextLabel", f)
                t.AutomaticSize = Enum.AutomaticSize.X
                t.Size = UDim2.new(0, 0, 1, 0)
                t.BackgroundTransparency = 1
                t.Font = Enum.Font.GothamBold
                t.TextSize = 13
                t.TextColor3 = Color3.fromRGB(255, 255, 255)
                t.Text = "..."
                return t
            end
            
            local fps, cpu, ping, ram = L(), L(), L(), L()
            local RSv = game:GetService("RunService")
            local ST = game:GetService("Stats")
            SL = RSv.RenderStepped:Connect(function(dt)
                if not g then return end
                local f = math.floor(workspace:GetRealPhysicsFPS())
                local c = math.floor(dt * 1000)
                local p = math.floor(ST.Network.ServerStatsItem["Data Ping"]:GetValue())
                local m = math.floor(ST:GetTotalMemoryUsageMb())
                fps.Text = "FPS: " .. f
                fps.TextColor3 = f >= 50 and Color3.fromRGB(0, 255, 127) or Color3.fromRGB(255, 65, 65)
                cpu.Text = "CPU: " .. c .. "ms"
                cpu.TextColor3 = c <= 20 and Color3.fromRGB(0, 255, 127) or (c <= 50 and Color3.fromRGB(255, 215, 0) or Color3.fromRGB(255, 65, 65))
                ping.Text = "Ping: " .. p .. "ms"
                ping.TextColor3 = p < 100 and Color3.fromRGB(0, 255, 127) or Color3.fromRGB(255, 65, 65)
                ram.Text = "Mem: " .. m .. "MB"
            end)
            SG = g
        else
            if SL then 
                SL:Disconnect()
                SL = nil 
            end
            if SG then 
                SG:Destroy()
                SG = nil 
            end
        end
    end)
    
    return {
        WalkSpeedToggle = walkSpeedToggle,
        InfJumpToggle = infJumpToggle,
        NoClipToggle = noClipToggle,
        WallWalkToggle = wallWalkToggle,
        OxygenToggle = infOxygenToggle,
        RadarToggle = espRadarToggle,
        StatsToggle = statsOverlayToggle
    }
end

return PlayerModule
